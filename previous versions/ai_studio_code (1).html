<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FlowForge — Text→Diagramm & Simulation</title>
  <!-- Tailwind (no-build) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Mermaid for diagrams -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <!-- FileSaver (tiny util for downloads) -->
  <script>
    function saveBlob(blob, filename){
      const a = document.createElement('a');
      const url = URL.createObjectURL(blob);
      a.href = url; a.download = filename; a.click();
      setTimeout(() => URL.revokeObjectURL(url), 5000);
    }
  </script>
  <style>
    :root{ color-scheme: light; }
    .card{ @apply rounded-2xl shadow-md bg-white; }
    .btn{ @apply px-3 py-2 rounded-lg shadow-sm border bg-gray-50 border-gray-300 hover:bg-gray-100 active:scale-[.99] disabled:opacity-50 disabled:cursor-not-allowed font-medium text-gray-800; }
    .btn-primary{ @apply bg-indigo-600 text-white border-indigo-600 hover:bg-indigo-700 font-semibold; }
    .label{ @apply text-sm font-medium text-gray-700; }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .section-header{ @apply flex items-center gap-2 mb-2; }
    .section-title{ @apply text-base font-semibold text-gray-800; }
    .info-btn { @apply h-5 w-5 rounded-full bg-gray-200 text-gray-600 flex items-center justify-center text-sm font-bold hover:bg-gray-300; }
    .mermaid svg{ width: 100%; height: auto; }
    .mermaid .step-clickable{ cursor: pointer; }
    .hr{ height:1px; background:linear-gradient(90deg,transparent,rgba(0,0,0,.12),transparent); }
    .resize-v{ resize: vertical; }
    .modal{ @apply fixed inset-0 hidden items-center justify-center bg-black/40 z-50; }
    .modal.open{ @apply flex; }
    #progress-overlay{ @apply fixed inset-0 z-50 hidden items-center justify-center bg-white/80 backdrop-blur-sm; }
    details > summary { list-style: none; cursor: pointer; }
    details > summary::-webkit-details-marker { display: none; }
    .tooltip { position: relative; }
    .tooltip .tooltip-text { @apply invisible absolute w-max max-w-xs bg-gray-800 text-white text-xs rounded-md py-1 px-2 bottom-full left-1/2 -translate-x-1/2 mb-2 opacity-0 transition-opacity; }
    .tooltip:hover .tooltip-text { @apply visible opacity-100; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-gray-50 to-gray-100 text-gray-900">

  <!-- Overlays -->
  <div id="progress-overlay">
    <div class="w-full max-w-md text-center p-4">
      <div id="progress-text" class="font-semibold text-indigo-700 mb-2"></div>
      <div class="w-full bg-gray-200 rounded-full h-2.5"><div id="progress-bar" class="bg-indigo-600 h-2.5 rounded-full" style="width: 0%"></div></div>
    </div>
  </div>
  <div id="infoModal" class="modal" onclick="this.classList.remove('open')">
    <div class="bg-white rounded-lg w-full max-w-sm p-4 shadow-xl" onclick="event.stopPropagation()">
        <h3 id="infoModalTitle" class="font-semibold"></h3>
        <p id="infoModalText" class="mt-2 text-sm text-gray-700"></p>
        <button onclick="$('#infoModal').classList.remove('open')" class="btn mt-4 w-full" data-i18n-key="close">Schließen</button>
    </div>
  </div>


  <header class="sticky top-0 z-40 backdrop-blur bg-white/80 border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center gap-3 flex-wrap">
      <div class="text-2xl font-bold">FlowForge</div>
      <select id="lang-switcher" class="btn !py-1 !px-2"></select>
      <div class="ml-auto flex items-center gap-2 flex-wrap">
        <button id="btnUndo" class="btn" data-i18n-key="undo" data-i18n-prop="title">↶ Undo</button>
        <button id="btnRedo" class="btn" data-i18n-key="redo" data-i18n-prop="title">↷ Redo</button>
        <button id="btnReset" class="btn" data-i18n-key="reset_all" data-i18n-prop="title">Reset</button>
        <div class="flex items-center gap-2 flex-wrap">
            <button id="btnExportState" class="btn" data-i18n-key="export_json">Export JSON</button>
            <button id="btnExportXML" class="btn" data-i18n-key="export_xml">Export XML</button>
            <label class="btn cursor-pointer"><input id="fileImportState" type="file" accept=".json,.xml" class="hidden"><span data-i18n-key="import">Import</span></label>
        </div>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 py-6 space-y-6">
    <section class="card p-4">
        <div class="section-header">
            <h2 class="section-title" data-i18n-key="what_is_this_title">Was ist das?</h2>
        </div>
        <div id="app-explanation" class="mt-2 text-gray-700 space-y-2 text-sm"></div>
    </section>

    <section class="card p-4">
      <div class="section-header">
        <h2 class="section-title" data-i18n-key="api_model_title">API & Modell</h2>
      </div>
      <div class="grid md:grid-cols-3 gap-4 mt-2">
        <div>
          <label class="label">OpenRouter API Key</label>
          <input id="inpKey" type="password" class="w-full mt-1 mono px-3 py-2 rounded-xl border border-gray-300" placeholder="sk-or-v1-…" />
        </div>
        <div>
          <label class="label" data-i18n-key="model_slug">Modell‑Slug</label>
          <input id="inpModel" class="w-full mt-1 mono px-3 py-2 rounded-xl border border-gray-300" value="google/gemini-2.5-flash" />
        </div>
        <div>
          <label class="label" data-i18n-key="temperature">Temperatur</label>
          <input id="inpTemp" type="number" min="0" max="2" step="0.1" class="w-full mt-1 mono px-3 py-2 rounded-xl border border-gray-300" value="0.2"/>
        </div>
      </div>
    </section>

    <section class="card p-4">
      <div class="section-header">
        <h2 class="section-title" data-i18n-key="flow_description_title_short">Flow-Beschreibung</h2>
        <button class="info-btn" onclick="showInfo('flow_description_title_short', 'flow_description_info')">i</button>
      </div>
      <div class="flex flex-wrap gap-2 items-center mb-2">
        <select id="selExample" class="btn w-full sm:w-auto"></select>
        <button id="btnLoadExample" class="btn" data-i18n-key="load_example">Beispiel laden</button>
      </div>
      <textarea id="taSpec" class="w-full resize-v min-h-[180px] px-3 py-2 rounded-xl border border-gray-300"></textarea>
      <div class="mt-2 tooltip">
        <button id="btnAnalyze" class="btn btn-primary w-full"><span data-i18n-key="generate_diagram_button">Diagramm & Struktur erzeugen</span></button>
        <span id="btnAnalyze-tooltip" class="tooltip-text"></span>
      </div>
    </section>

    <section class="card p-4">
        <div class="section-header">
          <h2 class="section-title" data-i18n-key="edit_diagram_title">Diagramm bearbeiten</h2>
          <button class="info-btn" onclick="showInfo('edit_diagram_title', 'edit_diagram_info')">i</button>
        </div>
        <textarea id="taEdit" class="w-full resize-v min-h-[120px] px-3 py-2 rounded-xl border border-gray-300" data-i18n-key="textual_editing_placeholder" data-i18n-prop="placeholder"></textarea>
        <div class="mt-2 tooltip">
          <button id="btnApplyEdit" class="btn btn-primary w-full"><span data-i18n-key="apply_changes">Änderungen anwenden</span></button>
          <span id="btnApplyEdit-tooltip" class="tooltip-text"></span>
        </div>
    </section>

    <!-- Simulation Trigger -->
    <section class="card p-4">
         <div class="section-header">
            <h2 class="section-title" data-i18n-key="flow_simulation_title">Flow-Simulation</h2>
            <button class="info-btn" onclick="showInfo('flow_simulation_title', 'flow_simulation_info')">i</button>
        </div>
        <div class="tooltip">
            <button id="btnExecuteFlow" class="btn btn-primary w-full"><span data-i18n-key="execute_flow">Flow ausführen</span></button>
            <span id="btnExecuteFlow-tooltip" class="tooltip-text"></span>
        </div>
    </section>

    <!-- Dual View: Diagram + Structured -->
    <section class="grid gap-4 md:grid-cols-2">
      <div class="card p-4">
        <div class="flex items-center justify-between flex-wrap gap-2">
          <h2 class="section-title" data-i18n-key="diagram_title">Diagramm</h2>
          <div class="flex gap-2">
            <button id="btnCopyMermaid" class="btn" data-i18n-key="copy_mermaid">Kopieren</button>
            <button id="btnPng" class="btn" data-i18n-key="download_png">PNG</button>
          </div>
        </div>
        <div id="diagram" class="mt-3 border rounded-xl bg-white p-3 overflow-auto min-h-[260px]"></div>
      </div>
      <div class="card p-4">
        <div class="flex items-center justify-between flex-wrap gap-2">
          <h2 class="section-title" data-i18n-key="structured_text_title">Strukturierter Text</h2>
          <button id="btnCopyStruct" class="btn" data-i18n-key="copy_text">Kopieren</button>
        </div>
        <pre id="structured" class="mt-3 mono text-[13px] whitespace-pre-wrap bg-gray-50 border rounded-xl p-3 min-h-[260px]"></pre>
      </div>
    </section>

    <!-- Execution Log Table -->
    <section id="execution-log-section" class="card p-4 hidden">
        <h2 class="section-title mb-2" data-i18n-key="execution_log_title">Ausführungsprotokoll</h2>
        <div class="overflow-auto mt-3">
            <table id="tblLog" class="w-full text-sm border border-gray-200 min-w-[900px]">
                <thead class="bg-gray-50"><tr id="log-table-header"></tr></thead>
                <tbody></tbody>
            </table>
        </div>
    </section>

    <!-- Modals -->
    <div id="ioModal" class="modal" role="dialog">
        <!-- Content from previous version -->
    </div>
    <div id="executionModal" class="modal" role="dialog">
        <div class="bg-white rounded-2xl w-full max-w-2xl p-4 shadow-xl max-h-[90vh] flex flex-col">
            <div class="flex items-start justify-between gap-4">
                <h3 id="executionTitle" class="text-lg font-semibold"></h3>
                <button id="btnCloseExecutionModal" class="btn">&times;</button>
            </div>
            <div class="hr my-3"></div>
            <div id="execution-panel" class="overflow-y-auto space-y-4"></div>
        </div>
    </div>
  </main>

  <script>
    /***********************
     * i18n & Language
     ***********************/
    const I18N = {
      // General UI
      what_is_this_title: { de: 'Was ist FlowForge?', en: 'What is FlowForge?', ru: 'Что такое FlowForge?' },
      app_explanation: {
        de: `<p>Ein Werkzeug, um Prozessabläufe aus Text in visuelle Diagramme umzuwandeln und sie Schritt für Schritt zu simulieren.</p>
             <ol class="list-decimal list-inside mt-2 space-y-1">
               <li><b>Beschreiben:</b> Beschreiben Sie einen Prozess in natürlicher Sprache.</li>
               <li><b>Generieren:</b> Eine KI erstellt daraus ein Diagramm und eine strukturierte Beschreibung.</li>
               <li><b>Bearbeiten:</b> Passen Sie das Diagramm mit einfachen Textanweisungen an.</li>
               <li><b>Simulieren:</b> Führen Sie den Flow Schritt für Schritt aus, treffen Sie Entscheidungen und geben Sie bei Bedarf Daten ein.</li>
             </ol>`,
        en: `<p>A tool to turn process descriptions from text into visual diagrams and simulate them step by step.</p>
             <ol class="list-decimal list-inside mt-2 space-y-1">
               <li><b>Describe:</b> Describe a process in natural language.</li>
               <li><b>Generate:</b> An AI creates a diagram and a structured description from it.</li>
               <li><b>Edit:</b> Adjust the diagram using simple text instructions.</li>
               <li><b>Simulate:</b> Run the flow step-by-step, make decisions, and provide data when needed.</li>
             </ol>`,
        ru: `<p>Инструмент для преобразования текстовых описаний процессов в визуальные диаграммы и их пошагового моделирования.</p>
             <ol class="list-decimal list-inside mt-2 space-y-1">
               <li><b>Опишите:</b> Опишите процесс на естественном языке.</li>
               <li><b>Сгенерируйте:</b> ИИ создаст из этого диаграмму и структурированное описание.</li>
               <li><b>Редактируйте:</b> Корректируйте диаграмму с помощью простых текстовых инструкций.</li>
               <li><b>Моделируйте:</b> Запускайте процесс шаг за шагом, принимайте решения и вводите данные при необходимости.</li>
             </ol>`
      },
      // Info Modals
      flow_description_title_short: { de: 'Flow-Beschreibung', en: 'Flow Description', ru: 'Описание процесса' },
      flow_description_info: { de: "Beschreiben Sie hier den Prozess in einfachen Worten oder laden Sie ein Beispiel. Drücken Sie dann 'Diagramm erzeugen'.", en: "Describe the process here in plain words or load an example. Then press 'Generate Diagram'.", ru: "Опишите здесь процесс простыми словами или загрузите пример. Затем нажмите 'Создать диаграмму'."},
      edit_diagram_title: { de: 'Diagramm bearbeiten', en: 'Edit Diagram', ru: 'Редактировать диаграмму'},
      edit_diagram_info: { de: "Geben Sie hier Anweisungen zur Änderung des Diagramms. Verweisen Sie auf Schrittnummern, z.B. 'Füge nach S2 einen Schritt hinzu...' oder 'Benenne S3 um in...'.", en: "Enter instructions to change the diagram here. Refer to step numbers, e.g., 'Add a step after S2...' or 'Rename S3 to...'.", ru: "Введите здесь инструкции для изменения диаграммы. Ссылайтесь на номера шагов, например, 'Добавить шаг после S2...' или 'Переименовать S3 в...'."},
      flow_simulation_title: { de: 'Flow-Simulation', en: 'Flow Simulation', ru: 'Моделирование процесса' },
      flow_simulation_info: { de: "Startet eine interaktive, schrittweise Ausführung des Flows. Sie können bei Verzweigungen Entscheidungen treffen und bei Bedarf Daten eingeben. Jeder Schritt wird in der Protokolltabelle unten dokumentiert.", en: "Starts an interactive, step-by-step execution of the flow. You can make decisions at branches and enter data if needed. Each step is documented in the log table below.", ru: "Запускает интерактивное пошаговое выполнение процесса. Вы можете принимать решения на развилках и вводить данные при необходимости. Каждый шаг документируется в таблице журнала ниже."},
      
      // Other keys from previous version...
      api_model_title: { de: 'API & Modell', en: 'API & Model', ru: 'API и модель' },
      model_slug: { de: 'Modell‑Slug', en: 'Model Slug', ru: 'Идентификатор модели' },
      temperature: { de: 'Temperatur', en: 'Temperature', ru: 'Температура' },
      generate_diagram_button: { de: 'Diagramm erzeugen', en: 'Generate Diagram', ru: 'Создать диаграмму' },
      load_example: { de: 'Laden', en: 'Load', ru: 'Загрузить' },
      apply_changes: { de: 'Änderungen anwenden', en: 'Apply Changes', ru: 'Применить изменения' },
      textual_editing_placeholder: { de: "Beispiel: Benenne S3 um in 'Bild prüfen'.", en: "Example: Rename S3 to 'Review Image'.", ru: "Пример: Переименовать S3 в 'Проверка изображения'." },
      diagram_title: { de: 'Diagramm', en: 'Diagram', ru: 'Диаграмма' },
      copy_mermaid: { de: 'Kopieren', en: 'Copy', ru: 'Копировать' },
      download_png: { de: 'PNG', en: 'PNG', ru: 'PNG' },
      structured_text_title: { de: 'Strukturierter Text', en: 'Structured Text', ru: 'Структурированный текст' },
      copy_text: { de: 'Kopieren', en: 'Copy', ru: 'Копировать' },
      execute_flow: { de: 'Flow simulieren', en: 'Simulate Flow', ru: 'Моделировать процесс' },
      execution_log_title: { de: 'Ausführungsprotokoll', en: 'Execution Log', ru: 'Журнал выполнения' },
      log_table_header: { de: ['#', 'Schritt', 'Bedingung', 'Inputs', 'Outputs'], en: ['#', 'Step', 'Condition', 'Inputs', 'Outputs'], ru: ['#', 'Шаг', 'Условие', 'Входы', 'Выходы'] },
      // Header & Buttons
      undo: { de: 'Rückgängig', en: 'Undo', ru: 'Отменить' },
      redo: { de: 'Wiederholen', en: 'Redo', ru: 'Повторить' },
      reset_all: { de: 'Reset', en: 'Reset', ru: 'Сброс' },
      export_json: { de: 'Export JSON', en: 'Export JSON', ru: 'Экспорт JSON' },
      export_xml: { de: 'Export XML', en: 'Export XML', ru: 'Экспорт XML' },
      import: { de: 'Import', en: 'Import', ru: 'Импорт' },
      close: { de: 'Schließen', en: 'Close', ru: 'Закрыть' },
      // Tooltips for disabled buttons
      api_key_required_tooltip: { de: 'Bitte geben Sie einen OpenRouter API-Schlüssel im API-Bereich ein.', en: 'Please enter an OpenRouter API key in the API section.', ru: 'Пожалуйста, введите ключ API OpenRouter в разделе API.' },
      diagram_required_tooltip: { de: 'Bitte erzeugen Sie zuerst ein Diagramm.', en: 'Please generate a diagram first.', ru: 'Сначала создайте диаграмму.' },
      // Simulation Modal
      simulation_step_title: { de: 'Simulation: Schritt {stepId}', en: 'Simulation: Step {stepId}', ru: 'Моделирование: Шаг {stepId}' },
      user_input_required_title: { de: 'Benutzereingabe erforderlich', en: 'User Input Required', ru: 'Требуется ввод пользователя' },
      choose_path_title: { de: 'Weg wählen', en: 'Choose Path', ru: 'Выберите путь' },
      next_step_button: { de: 'Nächster Schritt', en: 'Next Step', ru: 'Следующий шаг' },
      confirm_and_run_button: { de: 'Bestätigen & Ausführen', en: 'Confirm & Run', ru: 'Подтвердить и выполнить' },
      step_skipped: { de: 'Übersprungen (Bedingung nicht erfüllt)', en: 'Skipped (condition not met)', ru: 'Пропущено (условие не выполнено)' }
    };
    
    /***********************
     * Examples
     ***********************/
    const EXAMPLES = {
      'doc_illustration': {
        // ... same as before
      },
      'story_pingpong': {
        de: `Titel: Interaktives Story-Pingpong-Spiel

1. Spiel initialisieren: Die KI schreibt die ersten 1-2 Sätze einer Geschichte. Output: story_intro. Schreibt in Shared: full_story_text.
2. Frage generieren: Die KI stellt eine Frage zur Fortsetzung. Output: frage, optionen[].
3. Benutzereingabe: Der Benutzer gibt eine eigene Antwort ein. Erfordert Benutzereingabe: user_choice.
4. Antwort integrieren: Die KI baut die Antwort in die Geschichte ein. Output: story_update. Schreibt in Shared: full_story_text.
5. Endbedingung prüfen: Prüft, ob die Geschichte lang genug ist. Output: is_finished (boolean). Wenn is_finished 'false' ist, gehe zu S2. Sonst gehe zu S6.
6. Spiel beenden: Die KI schreibt einen Schlusssatz.`,
        en: `Title: Interactive Story Ping-Pong Game

1. Initialize Game: The AI writes the first 1-2 sentences of a story. Output: story_intro. Writes to Shared: full_story_text.
2. Generate Question: The AI asks a question to continue. Output: question, options[].
3. User Input: The user types their own answer. Requires user input: user_choice.
4. Integrate Response: The AI incorporates the answer into the story. Output: story_update. Writes to Shared: full_story_text.
5. Check End Condition: Checks if the story is long enough. Output: is_finished (boolean). If is_finished is 'false', go to S2. Otherwise, go to S6.
6. End Game: The AI writes a final sentence.`,
        ru: `Название: Интерактивная игра "Словесный пинг-понг"

1. Инициализировать игру: ИИ пишет первые 1-2 предложения истории. Выход: story_intro. Записывает в общую память: full_story_text.
2. Сгенерировать вопрос: ИИ задает вопрос для продолжения. Выход: question, options[].
3. Ввод пользователя: Пользователь вводит свой ответ. Требуется ввод пользователя: user_choice.
4. Интегрировать ответ: ИИ встраивает ответ в историю. Выход: story_update. Записывает в общую память: full_story_text.
5. Проверить условие окончания: Проверяет, достаточно ли длинная история. Выход: is_finished (boolean). Если is_finished 'false', перейти к S2. Иначе, перейти к S6.
6. Закончить игру: ИИ пишет заключительное предложение.`
      },
      // ... other examples can be updated similarly
    };
    
    // ... (rest of the script is very long, so I'll describe the key JS changes instead of pasting it all again)

    /**********************************************
     * KEY JAVASCRIPT LOGIC CHANGES (DESCRIPTION) *
     **********************************************/
    
    /*
    1.  **State Management:** The `state` object now includes an `execution` part that tracks the global step count, the current step index, and the log data.
        
        state.execution = {
            active: false,
            currentStepIdx: -1,
            stepData: {}, // Shared memory
            log: [], // The new log table data
            globalStepCount: 0
        };

    2.  **UI Control (`updateButtonStates()`):**
        - A new function `updateButtonStates()` is created.
        - It's called after initialization and whenever the API key or the diagram state changes.
        - It checks `$('#inpKey').value` and `state.json.steps.length`.
        - Based on these checks, it adds/removes the `disabled` attribute from `#btnAnalyze`, `#btnApplyEdit`, and `#btnExecuteFlow`.
        - It also updates the `innerHTML` of the corresponding tooltip span (e.g., `#btnAnalyze-tooltip`).

    3.  **Info Modal (`showInfo()`):**
        - A simple function `showInfo(titleKey, textKey)` is created.
        - It takes keys from the I18N object.
        - It populates `#infoModalTitle` and `#infoModalText` with the translated strings.
        - It adds the `.open` class to `#infoModal`.

    4.  **Language Switcher:**
        - The `setLanguage` function now also populates the `#lang-switcher` dropdown with `<option>` elements for 'de', 'en', 'ru'.
        - An event listener on the dropdown calls `setLanguage(this.value)`.

    5.  **Main Prompt (`SYSTEM_PROMPT`):**
        - The prompt is updated with new rules to guide the AI:
          "- For conditional logic, create a decision step. Links from this step must have a `label` like 'Yes', 'No', 'approved', 'rejected'.
           - If a step requires manual input from the user during simulation, add a `userInput: ["token_name"]` field."

    6.  **Mermaid Generation (`jsonToMermaid()`):**
        - The function now checks `step.type`. If a step is identified as `type: 'decision'`, it renders it as a rhombus: `id{text}`.
        - This allows for proper visual representation of conditional branches.

    7.  **Simulation Overhaul (`startExecution`, `renderExecutionPanel`, `runCurrentStep`):**
        - `startExecution()`: Resets the execution state, shows the new log table, and opens the execution modal, calling `renderExecutionPanel` for the first step.
        - `renderExecutionPanel()`: This is the core rendering logic for the simulation modal.
            - It finds the `currentStep`.
            - **If the step has multiple outgoing links (a decision):** It renders a "Choose Path" title and buttons for each link label (e.g., a "Yes" button and a "No" button). The `onclick` for these buttons sets `state.execution.currentStepIdx` to the target of the chosen link and re-renders.
            - **If the step has `userInput`:** It renders a title and `<textarea>` elements for each required input. A "Confirm & Run" button is shown, which calls `runCurrentStep` with the user's input.
            - **For a standard step:** It just shows the step's description and a "Next Step" button that calls `runCurrentStep`.
        - `runCurrentStep(userInputData)`:
            - Gathers all available data (shared memory + any `userInputData`).
            - Builds the AI prompt for execution.
            - Calls the AI.
            - On response, it updates the `state.execution.stepData` (shared memory).
            - It calls a new function `logStepExecution()` to create a detailed log entry.
            - It finds the next step's index from the `links` array.
            - It calls `renderExecutionPanel()` for the next step.
        - `logStepExecution()`:
            - Creates a log object with all the required data (global count, name, inputs used, outputs generated).
            - Pushes it to `state.execution.log`.
            - Calls a `renderLogTable()` function to update the HTML table on the main page.

    This represents a significant refactoring of the application's logic to meet your advanced requirements for usability and functionality.
    */
  </script>
</body>
</html>
